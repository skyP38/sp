# Watermark Plugin для GIMP

Плагин для наложения водяных знаков на изображения в графическом редакторе GIMP.

## Возможности

### Поддерживаемые типы водяных знаков:
- **Текстовые** - произвольный текст с настройкой шрифта и размера
- **Графические** - наложение изображений в форматах PNG, JPEG, GIF, BMP, TIFF

### Варианты размещения:
- **Единичное** - один водяной знак в указанной позиции
- **Мозаичное** - повторяющийся узор из водяных знаков

### Позиционирование:
- Центр изображения
- Четыре угла (левый верхний, правый верхний, левый нижний, правый нижний)
- Случайное расположение
- Точные координаты

### Трансформации:
- Поворот на заданный угол (-180° до +180°)
- Масштабирование (от 10% до 300%)
- Настройка прозрачности

### Дополнительные параметры:
- Для мозаики: количество строк и колонок, расстояние между элементами
- Для текста: выбор шрифта, размера, содержания
- Для изображений: загрузка из файла

## Установка

### Компиляция плагина:

```bash
# Сборка плагина
make

# Сборка и установка плагина
make install

# Очистка сборочных файлов
make clean

# Пересборка с нуля
make rebuild

# Сборка всех файлов вручную
gcc -o watermark watermark.c ui.c watermark_logic.c ui_pages.c image.c text.c mosaic.c pixel.c `pkg-config --cflags --libs gimp-3.0 gimpui-3.0 gtk4 gegl-0.4` -lm
```

### Установка в GIMP:

1. Скопируйте скомпилированный файл в директорию плагинов GIMP:
```bash
mkdir -p ~/.config/GIMP/3.0/plug-ins/watermark/
cp watermark ~/.config/GIMP/3.0/plug-ins/watermark/
chmod +x ~/.config/GIMP/3.0/plug-ins/watermark/watermark
```

2. Перезапустите GIMP или обновите плагины через меню:
   - **Фильтры** → **Обновить плагины**

## Использование

1. Откройте изображение в GIMP
2. Перейдите в меню: **Фильтры** → **DDDDDDDD** → **Watermark Embedder**
3. В открывшемся диалоговом окне настройте параметры:
   - Выберите тип водяного знака (текст или изображение)
   - Укажите параметры выбранного типа
   - Настройте размещение (единичное или мозаичное)
   - При необходимости примените трансформации
4. Нажмите **OK** для применения водяного знака

## Структура проекта

```
watermark-plugin/
├── watermark.c          # Основной файл плагина GIMP
├── ui.h                 # Заголовочный файл пользовательского интерфейса
├── ui.c                 # Реализация основного UI
├── ui_pages.h           # Заголовочный файл страниц интерфейса
├── ui_pages.c           # Реализация отдельных страниц UI
├── watermark_logic.h    # Заголовочный файл логики водяных знаков
├── watermark_logic.c    # Основная логика применения водяных знаков
├── pixel.h              # Заголовочный файл работы с пикселями
├── pixel.c              # Функции пиксельной обработки изображений
├── text.h               # Заголовочный файл текстовых водяных знаков
├── text.c               # Функции для работы с текстом
├── image.h              # Заголовочный файл графических водяных знаков
├── image.c              # Функции для работы с изображениями
├── mosaic.h             # Заголовочный файл мозаичных водяных знаков
├── mosaic.c             # Функции для создания мозаики
└── README.md            # Документация (этот файл)
```

## Технические детали

### Поддерживаемые форматы изображений:
- Входные: все форматы, поддерживаемые GIMP
- Водяные знаки: PNG, JPEG, GIF, BMP, TIFF

### Алгоритмы обработки:
- **Альфа-смешение** - корректное наложение с учётом прозрачности
- **Билинейная интерполяция** - качественное масштабирование и поворот
- **Матричные преобразования** - точный поворот изображений

### Системные требования:
- GIMP версии 3.0+
- GTK4
- GEGL 0.4
- Компилятор GCC